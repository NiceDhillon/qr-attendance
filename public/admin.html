<!DOCTYPE html>
<html>
<head>
  <title>Admin</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h2>Generate QR</h2>
  <button onclick="generate()">Generate QR</button>

  <p id="info"></p>
  <img id="qr">

  <br><br>
  <a href="/download">
    <button>Download CSV</button>
  </a>
</div>

<script>
function generate() {
  navigator.geolocation.getCurrentPosition(pos => {
    fetch("/generate-qr", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        accuracy: pos.coords.accuracy
      })
    })
    .then(r => r.json())
    .then(d => {
      document.getElementById("qr").src = d.qr;
      document.getElementById("info").innerText =
        `Generated: ${d.generatedAt}\nExpires: ${d.expiresAt}`;
    });
  }, err => alert("Location required"));
}
</script>

</body>
</html>
