<!DOCTYPE html>
<html>
<head>
  <title>Student - Mark Attendance</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h2>Mark Attendance</h2>

  <input id="name" placeholder="Name">
  <input id="roll" placeholder="Roll Number">
  <button onclick="mark()">Submit</button>

  <p id="status"></p>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const sessionId = params.get("session");

let deviceId = localStorage.getItem("deviceId");
if (!deviceId) {
  deviceId = crypto.randomUUID();
  localStorage.setItem("deviceId", deviceId);
}

function mark() {
  navigator.geolocation.getCurrentPosition(pos => {
    fetch("/mark-attendance", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: document.getElementById("name").value,
        roll: document.getElementById("roll").value,
        deviceId,
        sessionId,
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        accuracy: pos.coords.accuracy
      })
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById("status").innerText =
        data.success ? "Attendance marked successfully âœ…" : data.error;
    });
  });
}
</script>

</body>
</html>
